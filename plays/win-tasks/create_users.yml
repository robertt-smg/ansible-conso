- name: Ensure users are present
  ansible.windows.win_user:
    name: "{{ item.key }}"
    password: "{{ item.value.password }}"
    state: present
    account_expires: never
    groups: "{{ item.value.groups | default([]) }}"
    groups_action: add

  loop: "{{ winusers_list | dict2items }}"
  # Only create user if enabled is true
  when: item.value.enabled | default(false)
