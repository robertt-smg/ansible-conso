

- name: Check if FreeOpener is already installed
  ansible.windows.win_stat:
    path: 'C:\Program Files\Free Opener\FreeOpener.exe'
  register: freeopener_stat
 
- name: Copy FreeOpener Installer
  win_copy:
    src: files/freeopener_setup.exe
    dest: c:\\windows\\temp\\freeopener_setup.exe
  when: not freeopener_stat.stat.exists

- name: Install FreeOpener silently for all users
  ansible.windows.win_command: 'c:\windows\temp\freeopener_setup.exe /silent /allusers'
  when: not freeopener_stat.stat.exists

- name: Associate .msg files with OutlookMailMsg
  ansible.windows.win_command: 'cmd /c ASSOC .msg=OutlookMailMsg'
  #when: not freeopener_stat.stat.exists

- name: Set FTYPE for OutlookMailMsg to use FreeOpener
  ansible.windows.win_command: 'cmd /c FTYPE OutlookMailMsg="C:\Program Files\Free Opener\FreeOpener.exe" %%1'
  #when: not freeopener_stat.stat.exists
