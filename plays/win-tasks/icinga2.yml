
- name: Set Icinga Director JSON as a fact
  set_fact:
    icinga_install_json: >
      {
        "IfW-DirectorSelfServiceKey": {
          "Values": ["651f889ca5f364e89ed709eabde6237fb02050ff"]
        },
        "IfW-DirectorUrl": {
          "Values": ["https://icinga.example.com/icingaweb2/director"]
        }
      }
      
- name: Download and Icinga for Windows installation script
  win_shell: |
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 -bor [Net.SecurityProtocolType]::Tls11;
    $ProgressPreference                         = 'SilentlyContinue';
    $ScriptFile                         = 'C:\Users\Public\IcingaForWindows.ps1';
    
    Invoke-WebRequest  -UseBasicParsing -Uri 'https://packages.icinga.com/IcingaForWindows/IcingaForWindows.ps1' -OutFile $ScriptFile;

# TODO: Call Automatic Installer